<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link rel="dns-prefetch" href="https://blog.xxwhite.com"><link rel="preconnect" href="//cdn.jsdelivr.net"><title>基于OMV打造的All In One | 叉叉白</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="在 OMV (Debian) 上安装软路由虚拟机，并且网卡直通给虚拟机。"><meta property="og:type" content="article"><meta property="og:title" content="基于OMV打造的All In One"><meta property="og:url" content="https://blog.xxwhite.com/2020/omv-oia.html"><meta property="og:site_name" content="叉叉白"><meta property="og:description" content="在 OMV (Debian) 上安装软路由虚拟机，并且网卡直通给虚拟机。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://blog.xxwhite.com/assets/img/2020/200822_102319_msedge_EMI8.png"><meta property="og:image" content="https://blog.xxwhite.com/assets/img/2020/200822_102759_msedge_cwdv.png"><meta property="og:image" content="https://blog.xxwhite.com/assets/img/2020/200822_111808_msedge_0p5f.png"><meta property="og:image" content="https://blog.xxwhite.com/assets/img/2020/200822_113327_msedge_a76D.png"><meta property="og:image" content="https://blog.xxwhite.com/assets/img/2020/200721_112241_WindowsTerminal_6CmX.png"><meta property="og:image" content="https://blog.xxwhite.com/assets/img/2020/200721_112418_WindowsTerminal_Oeo6.png"><meta property="og:image" content="https://blog.xxwhite.com/assets/img/2020/200822_114626_msedge_oyRF.png"><meta property="og:image" content="https://blog.xxwhite.com/assets/img/2020/200822_115903_msedge_cD6K.png"><meta property="og:image" content="https://blog.xxwhite.com/assets/img/2020/200822_120500_msedge_VMYL.png"><meta property="og:image" content="https://blog.xxwhite.com/assets/img/2020/200822_122635_msedge_iZ6y.png"><meta property="article:published_time" content="2020-08-21T23:05:30.000Z"><meta property="article:modified_time" content="2021-03-25T02:35:30.816Z"><meta property="article:author" content="MonoLogueChi"><meta property="article:tag" content="软路由"><meta property="article:tag" content="NAS"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://blog.xxwhite.com/assets/img/2020/200822_102319_msedge_EMI8.png"><link rel="alternative" href="/atom.xml" title="叉叉白" type="application/atom+xml"><link rel="icon" href="/assets/img/favicon.png"><link rel="stylesheet" href="/assets/./main.18a6af.css"><style type="text/css">#container.show{background:linear-gradient(200deg,#a0cfe4,#e8c37e)}</style><script>function loadScript(e,t){d=document,o=d.createElement("script"),s=d.getElementsByTagName("head")[0].appendChild(o),o.setAttribute("src",e),t&&o.addEventListener("load",function(e){t(e)}),s.parentNode.insertBefore(o,s)}</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="container" q-class="show:isCtnShow"><canvas id="anm-canvas" class="anm-canvas"></canvas><div class="left-col" q-class="show:isShow"><div class="overlay" style="background:#4d4d4d"></div><div class="intrude-less"><header id="header" class="inner"><a href="" class="profilepic"><img src="/assets/img/avatar.jpg" class="js-avatar"></a><hgroup><h1 class="header-author"><a href=""></a></h1></hgroup><nav class="header-menu"><ul><li><a href="/">主页</a></li><li><a href="/tags/%E6%90%9E%E6%9C%BA/">搞机</a></li><li><a href="/MessageBoard/">留言</a></li><li><a href="/aboutme/">关于</a></li><li><a href="/tags/%E5%BB%BA%E7%AB%99%E7%AC%94%E8%AE%B0/">笔记</a></li><li><a href="/tags/timeline/">时光</a></li></ul></nav><nav class="header-smart-menu"><a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)" target="_self">所有文章</a> <a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)" target="_self">友链</a> <a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)" target="_self">关于本站</a></nav><nav class="header-nav"><div class="social"><a class="rss" target="_blank" href="/atom.xml" title="rss"><i class="icon-rss"></i></a> <a class="github" target="_blank" href="https://github.com/MonoLogueChi" title="github"><i class="icon-github"></i></a> <a class="qq" target="_blank" href="/assets/html/qq-groups.html" title="qq"><i class="icon-qq"></i></a> <a class="bilibili" target="_blank" href="https://space.bilibili.com/28474682/" title="bilibili"><i class="icon-bilibili"></i></a> <a class="mail" target="_blank" href="mailto:xxwhite@foxmail.com" title="mail"><i class="icon-mail"></i></a></div></nav></header></div></div><div class="mid-col" q-class="show:isShow,hide:isShow|isFalse"><nav id="mobile-nav"><div class="overlay js-overlay" style="background:#4d4d4d"></div><div class="btnctn js-mobile-btnctn"><div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div></div><div class="intrude-less"><header id="header" class="inner"><div class="profilepic"><a href="/"><img src="/assets/img/avatar.jpg" class="js-avatar"></a></div><hgroup><h1 class="header-author js-header-author"></h1></hgroup><nav class="header-nav"><div class="social"><a class="rss" target="_blank" href="/atom.xml" title="rss"><i class="icon-rss"></i></a> <a class="github" target="_blank" href="https://github.com/MonoLogueChi" title="github"><i class="icon-github"></i></a> <a class="qq" target="_blank" href="/assets/html/qq-groups.html" title="qq"><i class="icon-qq"></i></a> <a class="bilibili" target="_blank" href="https://space.bilibili.com/28474682/" title="bilibili"><i class="icon-bilibili"></i></a> <a class="mail" target="_blank" href="mailto:xxwhite@foxmail.com" title="mail"><i class="icon-mail"></i></a></div></nav><nav class="header-menu js-header-menu"><ul style="width:70%"><li style="width:16.666666666666668%"><a href="/">主页</a></li><li style="width:16.666666666666668%"><a href="/tags/%E6%90%9E%E6%9C%BA/">搞机</a></li><li style="width:16.666666666666668%"><a href="/MessageBoard/">留言</a></li><li style="width:16.666666666666668%"><a href="/aboutme/">关于</a></li><li style="width:16.666666666666668%"><a href="/tags/%E5%BB%BA%E7%AB%99%E7%AC%94%E8%AE%B0/">笔记</a></li><li style="width:16.666666666666668%"><a href="/tags/timeline/">时光</a></li></ul></nav></header></div><div class="mobile-mask" style="display:none" q-show="isShow"></div></nav><div id="wrapper" class="body-wrap"><div class="menu-l"><div class="canvas-wrap"><canvas data-colors="#eaeaea" data-sectionheight="100" data-contentid="js-content" id="myCanvas1" class="anm-canvas"></canvas></div><div id="js-content" class="content-ll"><article id="post-2020/omv-oia" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">基于OMV打造的All In One</h1><a href="/2020/omv-oia.html" class="archive-article-date"><time datetime="2020-08-21T23:05:30.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2020-08-21</time></a></header><div class="article-entry" itemprop="articleBody"><p>在 OMV (Debian) 上安装软路由虚拟机，并且网卡直通给虚拟机。</p><span id="more"></span><p>本文适用于 OMV5 ，演示版本为 5.5.8-1，其他版本是否适用，请自行判定。</p><p>这篇教程很复杂，不懂的可以看我以前写的教程，或者是到网上自己爬。</p><p>在前面一段时间，我写过一篇教程，讲的是在 PVE 上安装虚拟机组装 All In One，但是那一期并不完美，只把硬盘直通给了 OMV，而没有直通显卡，这样 OMV 并没有硬件解码的能力。</p><p>看网上大部分 Up 主的方案，都是创建 PVE 虚拟机，然后虚拟机上装 NAS，然后把 SATA 控制器和核显直通给 NAS，我就在想，为什么不直接在 NAS 上安装软路由虚拟机，然后再把网卡直通给软路由？</p><h2 id="准备">准备<a class="header-anchor" href="#准备">➴</a></h2><p>有想法就开搞，看几个常见的 NAS 系统，Synology，FreeNAS，OpenMediaVault。</p><p>这三个系统中，首先把 FreeNAS 排除，基于 FreeBSD 的系统，搞不定，然后是 Synology，白的教程我可以出，黑的是不可能的，但是白的那台我不会瞎折腾的。系统就敲定是 OpenMediaVault，基于 Debian，贼方便。</p><p>安装系统就略过了，这个网上有很多的教程，不过大部分 OMV 都是安装在单盘上的，如果想安装在 Raid 上，只需要一点技巧，这个以后可能会出一期教程的。</p><h2 id="安装拓展插件和内核">安装拓展插件和内核<a class="header-anchor" href="#安装拓展插件和内核">➴</a></h2><p>安装完 OMV 之后先更新系统</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo apt update</span></span><br><span class="line"><span class="attribute">sudo apt dist-upgrade</span></span><br></pre></td></tr></table></figure><p>然后安装<a target="_blank" rel="noopener" href="https://github.com/OpenMediaVault-Plugin-Developers/installScript">拓展插件</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O - https:<span class="regexp">//gi</span>thub.com<span class="regexp">/OpenMediaVault-Plugin-Developers/i</span>nstallScript<span class="regexp">/raw/m</span>aster/install | sudo bash</span><br></pre></td></tr></table></figure><p>安装完拓展插件以后，刷新网页，会有<code>OMV-Extras</code>这个选项，在内核选项卡中安装 PVE 内核，并设为默认启动内核。</p><p><img src="/assets/img/2020/200822_102319_msedge_EMI8.png" alt="安装拓展"></p><p>然后重启系统，使用 PVE 内核启动。</p><h2 id="安装-KVM-和-Cockpit">安装 KVM 和 Cockpit<a class="header-anchor" href="#安装-KVM-和-Cockpit">➴</a></h2><p>接下来安装虚拟机，首先安装 <code>Cockpit</code>，这个直接在 OMV 的面板上安装即可（这一步也可以不做，直接使用下面的命令行安装）</p><p><img src="/assets/img/2020/200822_102759_msedge_cwdv.png" alt="安装Cockpit"></p><p>然后安装 KVM 虚拟机相关的东西（如果不懂，直接照抄就行）</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt <span class="keyword">install </span>cockpit cockpit-* qemu qemu-kvm qemu-utils libvirt-* <span class="keyword">bridge-utils </span>virt-* net-tools</span><br></pre></td></tr></table></figure><p>尝试打开 Cockpit 面板看一下可设置的内容。</p><h2 id="创建网桥">创建网桥<a class="header-anchor" href="#创建网桥">➴</a></h2><p>如果你有多个网口想要作为 LAN 口，就需要把这些网卡桥接起来，作为一个网桥使用，在 OMV 里创建网桥非常简单，只要你做了上面的操作，就可以在 OMV 管理面板创建网桥了，注意 OMV5 的网络配置文件，和正常 Debian 的不一样，尽量不要直接修改配置文件。</p><p>创建网桥的过程中，当前连接的网口是不能被选择的，可以把这个网口留作后面要用的直通 WAN 口。</p><p><img src="/assets/img/2020/200822_111808_msedge_0p5f.png" alt="创建网桥"></p><p>创建完网桥之后，需要把网桥添加进 kvm 虚拟机里。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install <span class="keyword">vim</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">vim</span> ~/br0.xml</span><br></pre></td></tr></table></figure><p>添加下面内容，注意 name，我的是 br0，你的不知道是不是。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">network</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">name</span>&gt;</span>br0<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">forward</span> <span class="attr">mode</span>=<span class="string">&quot;bridge&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">bridge</span> <span class="attr">name</span>=<span class="string">&#x27;br0&#x27;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">network</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后添加进 kvm 虚拟机里</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo virsh net-define --file ~/br0.xml</span><br><span class="line">sudo virsh net-<span class="literal">start</span> br0</span><br></pre></td></tr></table></figure><p>然后就可以在 Cockpit 面板里看到这个网络了。</p><p><img src="/assets/img/2020/200822_113327_msedge_a76D.png" alt="查看网络"></p><h2 id="配置硬件直通">配置硬件直通<a class="header-anchor" href="#配置硬件直通">➴</a></h2><p>这里参考PVE虚拟机那一节</p><p>修改 grub 文件</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim <span class="regexp">/etc/</span><span class="keyword">default</span>/grub</span><br></pre></td></tr></table></figure><p>找到 <code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet&quot;</code>，修改为 <code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on&quot;</code>，amd 的话就改为 <code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet amd_iommu=on&quot;</code></p><p><img src="/assets/img/2020/200721_112241_WindowsTerminal_6CmX.png" alt=""></p><p>然后保存，输入命令</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo update-grub</span></span><br></pre></td></tr></table></figure><p>打开 <code>/etc/modules</code></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim <span class="regexp">/etc/m</span>odules</span><br></pre></td></tr></table></figure><p>增加以下内容</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vfio</span><br><span class="line">vfio_iommu_type1</span><br><span class="line">vfio_pci</span><br><span class="line">vfio_virqfd</span><br></pre></td></tr></table></figure><p><img src="/assets/img/2020/200721_112418_WindowsTerminal_Oeo6.png" alt=""></p><p>保存，并<strong>重启</strong>服务器。</p><h2 id="创建虚拟机">创建虚拟机<a class="header-anchor" href="#创建虚拟机">➴</a></h2><p>如果你是多网口的机器，并且刚才创建了网桥，创建虚拟机之前，我们要先改一下网线接口的位置，将网线从刚才的网口，改到创建好网桥的网口上。</p><p>首先我们创建一个存储池，在Cockpit面板里操作即可，创建完成后记得激活。</p><p><img src="/assets/img/2020/200822_114626_msedge_oyRF.png" alt="创建存储池"></p><p>然后上传镜像到此存储池中，在电脑上用SCP上传（不是NAS上）</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp <span class="symbol">D:</span>\MonoLogueChi\Desktop\<span class="number">1</span>\openwrt-x86<span class="number">-64</span>-generic-squashfs-combined-efi.qcow2 root<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">129</span><span class="symbol">:/srv/dev-disk-by-label-v/data/vm</span></span><br></pre></td></tr></table></figure><p>如果你不知用什么镜像，可以用我编译的<a target="_blank" rel="noopener" href="https://dl.u2sb.top/#/s/GPIQ?path=%2Fblog%2F%E8%BD%AF%E8%B7%AF%E7%94%B1%2FOpenWRT%2F%E8%87%AA%E5%B7%B1%E7%BC%96%E8%AF%91%E7%9A%84%E9%95%9C%E5%83%8F%2F%E7%B2%BE%E7%AE%80%E5%9B%BA%E4%BB%B6">精简版镜像</a></p><p>然后导入虚拟机，但不要立即启动，修改启动顺序，然后检查一下当前的网络接口是不是br0，如果是br0，就启动测试一下。</p><p><img src="/assets/img/2020/200822_115903_msedge_cD6K.png" alt="引导顺序"></p><p>看一下网卡是不是正常的。</p><p><img src="/assets/img/2020/200822_120500_msedge_VMYL.png" alt="网卡"></p><h2 id="硬件直通">硬件直通<a class="header-anchor" href="#硬件直通">➴</a></h2><h3 id="可以PCIE直通">可以PCIE直通<a class="header-anchor" href="#可以PCIE直通">➴</a></h3><p>测试完之后虚拟机关机，然后搞硬件直通。</p><p>下面这一步，最好打开一个记事本，把需要记录的都粘贴进去。</p><p>首先是看网卡的id，这一部分可以参考我们上一期的PVE教程。</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dmesg <span class="string">| grep eth</span></span><br></pre></td></tr></table></figure><p>会输出大概这么一长串东西</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[    1.294563]</span> <span class="selector-tag">e1000e</span> <span class="selector-tag">0000</span>:<span class="selector-tag">00</span>:<span class="selector-tag">19</span><span class="selector-class">.0</span> <span class="selector-tag">eth0</span>: (PCI <span class="attribute">Express</span>:<span class="number">2.5</span>GT/<span class="attribute">s</span>:Width x1) <span class="selector-tag">bc</span>:<span class="selector-tag">5f</span>:<span class="selector-tag">f4</span>:<span class="selector-tag">ab</span>:<span class="selector-tag">d8</span>:<span class="selector-tag">7b</span></span><br><span class="line"><span class="selector-attr">[    1.294564]</span> <span class="selector-tag">e1000e</span> <span class="selector-tag">0000</span>:<span class="selector-tag">00</span>:<span class="selector-tag">19</span><span class="selector-class">.0</span> <span class="selector-tag">eth0</span>: <span class="selector-tag">Intel</span>(R) <span class="selector-tag">PRO</span>/<span class="selector-tag">1000</span> <span class="selector-tag">Network</span> <span class="selector-tag">Connection</span></span><br><span class="line"><span class="selector-attr">[    1.294597]</span> <span class="selector-tag">e1000e</span> <span class="selector-tag">0000</span>:<span class="selector-tag">00</span>:<span class="selector-tag">19</span><span class="selector-class">.0</span> <span class="selector-tag">eth0</span>: <span class="selector-tag">MAC</span>: <span class="selector-tag">10</span>, <span class="selector-tag">PHY</span>: <span class="selector-tag">11</span>, <span class="selector-tag">PBA</span> <span class="selector-tag">No</span>: <span class="selector-tag">FFFFFF-0FF</span></span><br><span class="line"><span class="selector-attr">[    1.405764]</span> <span class="selector-tag">e1000e</span> <span class="selector-tag">0000</span>:<span class="selector-tag">04</span>:<span class="selector-tag">00</span><span class="selector-class">.0</span> <span class="selector-tag">eth1</span>: (PCI <span class="attribute">Express</span>:<span class="number">2.5</span>GT/<span class="attribute">s</span>:Width x1) <span class="selector-tag">bc</span>:<span class="selector-tag">5f</span>:<span class="selector-tag">f4</span>:<span class="selector-tag">ab</span>:<span class="selector-tag">d8</span>:<span class="selector-tag">7c</span></span><br><span class="line"><span class="selector-attr">[    1.405765]</span> <span class="selector-tag">e1000e</span> <span class="selector-tag">0000</span>:<span class="selector-tag">04</span>:<span class="selector-tag">00</span><span class="selector-class">.0</span> <span class="selector-tag">eth1</span>: <span class="selector-tag">Intel</span>(R) <span class="selector-tag">PRO</span>/<span class="selector-tag">1000</span> <span class="selector-tag">Network</span> <span class="selector-tag">Connection</span></span><br><span class="line"><span class="selector-attr">[    1.405787]</span> <span class="selector-tag">e1000e</span> <span class="selector-tag">0000</span>:<span class="selector-tag">04</span>:<span class="selector-tag">00</span><span class="selector-class">.0</span> <span class="selector-tag">eth1</span>: <span class="selector-tag">MAC</span>: <span class="selector-tag">4</span>, <span class="selector-tag">PHY</span>: <span class="selector-tag">8</span>, <span class="selector-tag">PBA</span> <span class="selector-tag">No</span>: <span class="selector-tag">FFFFFF-0FF</span></span><br><span class="line"><span class="selector-attr">[    1.407947]</span> <span class="selector-tag">e1000e</span> <span class="selector-tag">0000</span>:<span class="selector-tag">00</span>:<span class="selector-tag">19</span><span class="selector-class">.0</span> <span class="selector-tag">enp0s25</span>: <span class="selector-tag">renamed</span> <span class="selector-tag">from</span> <span class="selector-tag">eth0</span></span><br><span class="line"><span class="selector-attr">[    1.496268]</span> <span class="selector-tag">e1000e</span> <span class="selector-tag">0000</span>:<span class="selector-tag">04</span>:<span class="selector-tag">00</span><span class="selector-class">.0</span> <span class="selector-tag">enp4s0</span>: <span class="selector-tag">renamed</span> <span class="selector-tag">from</span> <span class="selector-tag">eth1</span></span><br><span class="line"><span class="selector-attr">[    1.552373]</span> <span class="selector-tag">r8125</span> <span class="selector-tag">0000</span>:<span class="selector-tag">01</span>:<span class="selector-tag">00</span><span class="selector-class">.0</span> <span class="selector-tag">enp1s0</span>: <span class="selector-tag">renamed</span> <span class="selector-tag">from</span> <span class="selector-tag">eth0</span></span><br><span class="line"><span class="selector-attr">[    6.041822]</span> <span class="selector-tag">e1000e</span> <span class="selector-tag">0000</span>:<span class="selector-tag">04</span>:<span class="selector-tag">00</span><span class="selector-class">.0</span> <span class="selector-tag">eth0</span>: (PCI <span class="attribute">Express</span>:<span class="number">2.5</span>GT/<span class="attribute">s</span>:Width x1) <span class="selector-tag">bc</span>:<span class="selector-tag">5f</span>:<span class="selector-tag">f4</span>:<span class="selector-tag">ab</span>:<span class="selector-tag">d8</span>:<span class="selector-tag">7c</span></span><br><span class="line"><span class="selector-attr">[    6.041824]</span> <span class="selector-tag">e1000e</span> <span class="selector-tag">0000</span>:<span class="selector-tag">04</span>:<span class="selector-tag">00</span><span class="selector-class">.0</span> <span class="selector-tag">eth0</span>: <span class="selector-tag">Intel</span>(R) <span class="selector-tag">PRO</span>/<span class="selector-tag">1000</span> <span class="selector-tag">Network</span> <span class="selector-tag">Connection</span></span><br><span class="line"><span class="selector-attr">[    6.041838]</span> <span class="selector-tag">e1000e</span> <span class="selector-tag">0000</span>:<span class="selector-tag">04</span>:<span class="selector-tag">00</span><span class="selector-class">.0</span> <span class="selector-tag">eth0</span>: <span class="selector-tag">MAC</span>: <span class="selector-tag">4</span>, <span class="selector-tag">PHY</span>: <span class="selector-tag">8</span>, <span class="selector-tag">PBA</span> <span class="selector-tag">No</span>: <span class="selector-tag">FFFFFF-0FF</span></span><br><span class="line"><span class="selector-attr">[    6.043005]</span> <span class="selector-tag">e1000e</span> <span class="selector-tag">0000</span>:<span class="selector-tag">04</span>:<span class="selector-tag">00</span><span class="selector-class">.0</span> <span class="selector-tag">enp4s0</span>: <span class="selector-tag">renamed</span> <span class="selector-tag">from</span> <span class="selector-tag">eth0</span></span><br><span class="line"><span class="selector-attr">[ 5406.455848]</span> <span class="selector-tag">e1000e</span> <span class="selector-tag">0000</span>:<span class="selector-tag">04</span>:<span class="selector-tag">00</span><span class="selector-class">.0</span> <span class="selector-tag">eth0</span>: (PCI <span class="attribute">Express</span>:<span class="number">2.5</span>GT/<span class="attribute">s</span>:Width x1) <span class="selector-tag">bc</span>:<span class="selector-tag">5f</span>:<span class="selector-tag">f4</span>:<span class="selector-tag">ab</span>:<span class="selector-tag">d8</span>:<span class="selector-tag">7c</span></span><br><span class="line"><span class="selector-attr">[ 5406.455850]</span> <span class="selector-tag">e1000e</span> <span class="selector-tag">0000</span>:<span class="selector-tag">04</span>:<span class="selector-tag">00</span><span class="selector-class">.0</span> <span class="selector-tag">eth0</span>: <span class="selector-tag">Intel</span>(R) <span class="selector-tag">PRO</span>/<span class="selector-tag">1000</span> <span class="selector-tag">Network</span> <span class="selector-tag">Connection</span></span><br><span class="line"><span class="selector-attr">[ 5406.455864]</span> <span class="selector-tag">e1000e</span> <span class="selector-tag">0000</span>:<span class="selector-tag">04</span>:<span class="selector-tag">00</span><span class="selector-class">.0</span> <span class="selector-tag">eth0</span>: <span class="selector-tag">MAC</span>: <span class="selector-tag">4</span>, <span class="selector-tag">PHY</span>: <span class="selector-tag">8</span>, <span class="selector-tag">PBA</span> <span class="selector-tag">No</span>: <span class="selector-tag">FFFFFF-0FF</span></span><br><span class="line"><span class="selector-attr">[ 5406.457045]</span> <span class="selector-tag">e1000e</span> <span class="selector-tag">0000</span>:<span class="selector-tag">04</span>:<span class="selector-tag">00</span><span class="selector-class">.0</span> <span class="selector-tag">enp4s0</span>: <span class="selector-tag">renamed</span> <span class="selector-tag">from</span> <span class="selector-tag">eth0</span></span><br></pre></td></tr></table></figure><p>我想要直通的网卡是 <code>enp4s0</code>，我找到了相关的ID</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">0000</span>:<span class="number">04</span>:<span class="number">00</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure><p>那这个有啥用呢？再来看下面的（如果不是新手，下面这一部分其实不用做）</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh nodedev-list --tree <span class="string">|grep pci</span></span><br></pre></td></tr></table></figure><p>会输出一个这样的东西</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+- pci_0000_00_00_0</span></span><br><span class="line"><span class="addition">+- pci_0000_00_01_0</span></span><br><span class="line">|   +- pci_0000_01_00_0</span><br><span class="line"><span class="addition">+- pci_0000_00_02_0</span></span><br><span class="line"><span class="addition">+- pci_0000_00_14_0</span></span><br><span class="line"><span class="addition">+- pci_0000_00_16_0</span></span><br><span class="line"><span class="addition">+- pci_0000_00_16_3</span></span><br><span class="line"><span class="addition">+- pci_0000_00_19_0</span></span><br><span class="line"><span class="addition">+- pci_0000_00_1a_0</span></span><br><span class="line"><span class="addition">+- pci_0000_00_1b_0</span></span><br><span class="line"><span class="addition">+- pci_0000_00_1c_0</span></span><br><span class="line"><span class="addition">+- pci_0000_00_1c_2</span></span><br><span class="line">|   +- pci_0000_03_00_0</span><br><span class="line"><span class="addition">+- pci_0000_00_1c_4</span></span><br><span class="line">|   +- pci_0000_04_00_0</span><br><span class="line"><span class="addition">+- pci_0000_00_1d_0</span></span><br><span class="line"><span class="addition">+- pci_0000_00_1f_0</span></span><br><span class="line"><span class="addition">+- pci_0000_00_1f_2</span></span><br><span class="line"><span class="addition">+- pci_0000_00_1f_3</span></span><br></pre></td></tr></table></figure><p>在里面找到 <code>pci_0000_04_00_0</code> ，就是前面我们找到的网卡，别着急，接着看。</p><p>输入命令</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">virsh</span> nodedev-dumpxml pci_<span class="number">0000</span>_<span class="number">04</span>_<span class="number">00</span>_<span class="number">0</span></span><br></pre></td></tr></table></figure><p>会输出这样的一堆东西</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">device</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>pci_0000_04_00_0<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">path</span>&gt;</span>/sys/devices/pci0000:00/0000:00:1c.4/0000:04:00.0<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span>pci_0000_00_1c_4<span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">driver</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>vfio-pci<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">driver</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">capability</span> <span class="attr">type</span>=<span class="string">&#x27;pci&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">domain</span>&gt;</span>0<span class="tag">&lt;/<span class="name">domain</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bus</span>&gt;</span>4<span class="tag">&lt;/<span class="name">bus</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span>0<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">function</span>&gt;</span>0<span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">product</span> <span class="attr">id</span>=<span class="string">&#x27;0x150c&#x27;</span>&gt;</span>82583V Gigabit Network Connection<span class="tag">&lt;/<span class="name">product</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vendor</span> <span class="attr">id</span>=<span class="string">&#x27;0x8086&#x27;</span>&gt;</span>Intel Corporation<span class="tag">&lt;/<span class="name">vendor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">iommuGroup</span> <span class="attr">number</span>=<span class="string">&#x27;14&#x27;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">address</span> <span class="attr">domain</span>=<span class="string">&#x27;0x0000&#x27;</span> <span class="attr">bus</span>=<span class="string">&#x27;0x04&#x27;</span> <span class="attr">slot</span>=<span class="string">&#x27;0x00&#x27;</span> <span class="attr">function</span>=<span class="string">&#x27;0x0&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">iommuGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pci-express</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">link</span> <span class="attr">validity</span>=<span class="string">&#x27;cap&#x27;</span> <span class="attr">port</span>=<span class="string">&#x27;0&#x27;</span> <span class="attr">speed</span>=<span class="string">&#x27;2.5&#x27;</span> <span class="attr">width</span>=<span class="string">&#x27;1&#x27;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">link</span> <span class="attr">validity</span>=<span class="string">&#x27;sta&#x27;</span> <span class="attr">speed</span>=<span class="string">&#x27;2.5&#x27;</span> <span class="attr">width</span>=<span class="string">&#x27;1&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pci-express</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">capability</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">device</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上面这些最好记在一个地方，方便等下查看。</p><p>接着detach设备</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">virsh</span> nodedev-dettach pci_<span class="number">0000</span>_<span class="number">04</span>_<span class="number">00</span>_<span class="number">0</span></span><br></pre></td></tr></table></figure><p>然后编辑虚拟机配置文件，具体名称看你刚才设置的</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/etc/</span>libvirt<span class="regexp">/qemu/</span>openwrt.xml</span><br></pre></td></tr></table></figure><p>添加一部分</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">devices</span>&gt;</span></span><br><span class="line">......</span><br><span class="line">  <span class="tag">&lt;<span class="name">hostdev</span> <span class="attr">mode</span>=<span class="string">&#x27;subsystem&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;pci&#x27;</span> <span class="attr">managed</span>=<span class="string">&#x27;yes&#x27;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">source</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">address</span> <span class="attr">domain</span>=<span class="string">&#x27;0x0000&#x27;</span> <span class="attr">bus</span>=<span class="string">&#x27;0x04&#x27;</span> <span class="attr">slot</span>=<span class="string">&#x27;0x00&#x27;</span> <span class="attr">function</span>=<span class="string">&#x27;0x0&#x27;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">hostdev</span>&gt;</span></span><br><span class="line">......</span><br><span class="line"><span class="tag">&lt;/<span class="name">devices</span>&gt;</span></span><br></pre></td></tr></table></figure><p>其中的 <code>&lt;address domain='0x0000' bus='0x04' slot='0x00' function='0x0'/&gt;</code>，这一部分按照上面的填。</p><p>添加完成之后，保存，然后重启主机，再打开虚拟机，看一下是否有另一张网卡。</p><h3 id="不能硬件直通">不能硬件直通<a class="header-anchor" href="#不能硬件直通">➴</a></h3><p>如果你的网卡是那种螃蟹卡，不能pcie直通，就按照下面的来做。</p><p>在虚拟机这里再添加一张网卡</p><p><img src="/assets/img/2020/200822_122635_msedge_iZ6y.png" alt="添加网卡"></p><p>这样虽然也能用，但是效率肯定没有硬件直通高。</p><p>开机，输入 <code>ifconfig -a</code> 查看另一张网卡是否存在。</p><h2 id="设置">设置<a class="header-anchor" href="#设置">➴</a></h2><p>接下来就是正常软路由的设置了，因为前面开机过一次，可能会遇到没有WAN口的情况，遇到这种情况，手动创建一个WAN口就可以了。</p><h2 id="补充">补充<a class="header-anchor" href="#补充">➴</a></h2><p>貌似按照上面操作，OMV上的DNS会被NetworkManager接管，导致DNS配置出现问题。这个可以通过修改NetworkManager配置文件解决</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/etc/</span>NetworkManager/NetworkManager.conf</span><br></pre></td></tr></table></figure><p>修改</p><h2 id="code￼22"><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[main]</span></span><br><span class="line"><span class="attr">dns</span>=none</span><br><span class="line"><span class="attr">no-auto-default</span>=*</span><br></pre></td></tr></table></figure><a class="header-anchor" href="#code￼22">➴</a></h2><p>参考</p><blockquote><p>KVM 安装部分 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/113187354">https://zhuanlan.zhihu.com/p/113187354</a><br>硬件直通部分 <a target="_blank" rel="noopener" href="https://libvirt.org/formatdomain.html">https://libvirt.org/formatdomain.html</a></p></blockquote><div class="page-reward"><a href="javascript:;" class="page-reward-btn tooltip-top"><div class="tooltip tooltip-east"><span class="tooltip-item">赏 </span><span class="tooltip-content"><span class="tooltip-text"><span class="tooltip-inner"><p class="reward-p"><i class="icon icon-quo-left"></i>请作者吃辣条<i class="icon icon-quo-right"></i></p><div class="reward-box"><div class="reward-box-item"><img class="reward-img" src="/assets/img/alipay.png"> <span class="reward-type">支付宝</span></div><div class="reward-box-item"><img class="reward-img" src="/assets/img/wechatpay.png"> <span class="reward-type">微信</span></div></div></span></span></span></div></a></div><div><ul class="post-copyright"><li><strong>本文作者：</strong> MonoLogueChi</li><li><strong>本文链接：</strong> <a href="https://blog.xxwhite.com/2020/omv-oia.html" title="叉叉白">https://blog.xxwhite.com/2020/omv-oia.html</a></li><li><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li></ul></div></div><div class="article-info article-info-index"><div class="article-tag tagcloud"><i class="icon-price-tags icon"></i><ul class="article-tag-list"><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag article-tag-list-link color4">软路由</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag article-tag-list-link color4">NAS</a></li></ul></div><div class="clearfix"></div></div></div></article><nav id="article-nav"><a href="/2020/omv-0.html" id="article-nav-newer" class="article-nav-link-wrap"><i class="icon-circle-left"></i><div class="article-nav-title">OMV安装</div></a><a href="/2020/pve-router.html" id="article-nav-older" class="article-nav-link-wrap"><div class="article-nav-title">PVE虚拟机安装软路由</div><i class="icon-circle-right"></i></a><br><a onclick="mdpage()" target="_blank" style="cursor:pointer">获取文章MarkDown文件</a> <span style="float:right;color:#0094d5" id="/2020/omv-oia.html" class="leancloud_visitors" data-flag-title="基于OMV打造的All In One"><span class="post-meta-item-text">本文阅读量 </span><span class="leancloud-visitors-count">8848</span></span></nav><script>var mdhost="https://raw.githubusercontent.com/MonoLogueChi/blog.xxwhite.com/master/source/_posts",mdurl="2020/omv-oia.html".replace(".html",".md");function mdpage(){window.open(mdhost+"/"+mdurl)}</script><aside class="wrap-side-operation"><div class="mod-side-operation"><div class="jump-container" id="js-jump-container" style="display:none"><a href="javascript:void(0)" class="mod-side-operation__jump-to-top"><i class="icon-font icon-back"></i></a><div id="js-jump-plan-container" class="jump-plan-container" style="top:-11px"><i class="icon-font icon-plane jump-plane"></i></div></div><div class="toc-container tooltip-left"><i class="icon-font icon-category"></i><div class="tooltip tooltip-east"><span class="tooltip-item"></span> <span class="tooltip-content"><div class="toc-article"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87"><span class="toc-number">1.</span> <span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%8B%93%E5%B1%95%E6%8F%92%E4%BB%B6%E5%92%8C%E5%86%85%E6%A0%B8"><span class="toc-number">2.</span> <span class="toc-text">安装拓展插件和内核</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-KVM-%E5%92%8C-Cockpit"><span class="toc-number">3.</span> <span class="toc-text">安装 KVM 和 Cockpit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BD%91%E6%A1%A5"><span class="toc-number">4.</span> <span class="toc-text">创建网桥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%A1%AC%E4%BB%B6%E7%9B%B4%E9%80%9A"><span class="toc-number">5.</span> <span class="toc-text">配置硬件直通</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">6.</span> <span class="toc-text">创建虚拟机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%9B%B4%E9%80%9A"><span class="toc-number">7.</span> <span class="toc-text">硬件直通</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E4%BB%A5PCIE%E7%9B%B4%E9%80%9A"><span class="toc-number">7.1.</span> <span class="toc-text">可以PCIE直通</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E8%83%BD%E7%A1%AC%E4%BB%B6%E7%9B%B4%E9%80%9A"><span class="toc-number">7.2.</span> <span class="toc-text">不能硬件直通</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE"><span class="toc-number">8.</span> <span class="toc-text">设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E5%85%85"><span class="toc-number">9.</span> <span class="toc-text">补充</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#code%EF%BF%BC22"><span class="toc-number">10.</span> <span class="toc-text">1 2 3 [main] dns&#x3D;none no-auto-default&#x3D;*</span></a></li></ol></div></span></div></div></div></aside><section id="comments"><div id="vcomment"></div><script>var valineConifg={appId:"BOnDPDiz9EeoGAC11JdnV9mw-gzGzoHsz",appKey:"gNFFgOahNl9DGsyX1WearaYO",mini:!1,avatar:"",avatar_cdn:"https://sdn.geekzu.org/avatar/",placeholder:"点击评论",pageSize:12,visitor:!0,recordIP:!0,serverURLs:"https://leancloud.xxwhite.com",version:"latest",adminEmailMd5:"a70ed099981735ebdf3d7c71dc507559",el:"#vcomment"},valineVersion=valineConifg.version,valineSrc=valineConifg.mini?"https://cdn.jsdelivr.net/npm/minivaline@"+valineVersion+"/dist/MiniValine.min.js":"https://cdn.jsdelivr.net/npm/valine@"+valineVersion+"/dist/Valine.min.js";loadScript(valineSrc,function(){var n;new(valineConifg.mini?MiniValine:Valine)(valineConifg),window.location.hash&&(n=setInterval(function(){document.getElementById(window.location.hash.replace("#",""))&&(location.href=window.location.hash,clearInterval(n))},250))})</script></section></div></div></div><footer id="footer"><div class="outer"><div id="footer-info"><div class="footer-left">&copy; 2015-2021 MonoLogueChi<br><a href="http://beian.miit.gov.cn/" target="_blank">蒙ICP备17004911号-1</a></div><div class="footer-right"><div><a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/MonoLogueChi/hexo-theme-yilia" target="_blank">Yilia</a> by Litten</div><div>本站由 <a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank"><img src="/assets/img/upyun.png" height="25px"> </a>提供CDN加速/云存储服务</div></div></div></div></footer></div><script>var yiliaConfig={mathjax:!1,isHome:!1,isPost:!0,isArchive:!1,isTag:!1,isCategory:!1,open_in_new:!1,toc_hide_index:!1,root:"/",innerArchive:!0,showTags:!1}</script><script>loadScript("/assets/main.18a6af.js"),loadScript("/assets/slider.b6b631.js")</script><script>loadScript("https://www.googletagmanager.com/gtag/js?id=UA-113200574-1",function(){function a(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],a("js",new Date),a("config","UA-113200574-1")})</script><script>loadScript("https://hm.baidu.com/hm.js?893dcb25b87bcda2f682b3a6d5c537f7")</script><script async>loadScript("https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js",function(){pangu.spacingPage()})</script><div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)"><div class="tools-nav header-menu"><ul style="width:70%"><li style="width:33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li><li style="width:33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li><li style="width:33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于本站</a></li></ul></div><div class="tools-wrap"><section class="tools-section tools-section-all" q-show="innerArchive"><div class="search-wrap"><input class="search-ipt" q-model="search" type="text" placeholder="find something…"> <i class="icon-search icon" q-show="search|isEmptyStr"></i> <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i></div><div class="widget tagcloud search-tag"><p class="search-tag-wording">tag:</p><label class="search-switch"><input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags"></label><ul class="article-tag-list" q-show="showTags"><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color3">搞机</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color5">建站笔记</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color1">Unity</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color3">测试</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color5">随便水水</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color3">C#</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color4">涨姿势</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color3">软件</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color1">炎黄幼儿园</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color4">小工具</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color4">香橙派</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color4">服务器</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color5">个人电脑</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color2">dotnet</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color1">Linux</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color3">硬件</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color4">软路由</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color4">NAS</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color4">OMV</a></li><li class="article-tag-list-item"><a href="javascript:void(0)" class="js-tag color4">timeline</a></li><div class="clearfix"></div></ul></div><ul class="search-ul"><li class="search-li" q-repeat="items" q-show="isShow"><a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a><p class="search-time"><i class="icon-calendar icon"></i> <span q-text="date|dateformat"></span></p><p class="search-tag"><i class="icon-price-tags icon"></i> <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span></p></li></ul></section><section class="tools-section tools-section-friends" q-show="friends"><ul class="search-ul"><li class="search-li"><a href="https://blog.xxwhite.com/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>叉叉白</a></li><li class="search-li"><a href="https://minemine.cc/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>大姐姐的博客Minemine</a></li><li class="search-li"><a href="http://socoolapk.top/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>酷安基佬</a></li><li class="search-li"><a href="https://www.se7ensec.cn/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>Se7en</a></li><li class="search-li"><a href="https://blog.isoyu.com/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>姬长信</a></li><li class="search-li"><a href="http://staunchkai.com/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>staunchkai</a></li><li class="search-li"><a href="https://www.iszy.cc/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>随遇而安</a></li><li class="search-li"><a href="https://zsh2401.top/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>2401的晚秋咖啡</a></li><li class="search-li"><a href="https://careyq.cool" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>CareyQ</a></li><li class="search-li"><a href="https://liujunzhou.top/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>Junzhou Liu</a></li><li class="search-li"><a href="https://yi-yun.github.io/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>Yi-Yun</a></li><li class="search-li"><a href="https://www.lmcjl.com" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>LmCjl在线工具</a></li><li class="search-li"><a href="https://blogs.kainy.cn/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>Freetao’s Blog</a></li></ul></section><section class="tools-section tools-section-me" q-show="aboutme"><div class="aboutme-wrap" id="js-aboutme">叉叉白 一个小白搞机的记事本</div></section></div></div><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button> <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></body></html>